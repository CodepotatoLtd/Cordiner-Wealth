pipelines:
  branches:
    'dev':
      - parallel:
        - step:
            name: RIPS Security Scan
            image: rips/rips-cli:3
            script:
              - rips-cli -vvv rips:scan:start -a $RIPS_APP_ID -p $BITBUCKET_CLONE_DIR -t 0
        - step:
            name: CodeSniffer Tests
            image: php:7.2
            caches:
              - composer
            script:
              - apt-get update && apt-get install -y unzip
              - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
              - composer require wp-coding-standards/wpcs
              - composer install
              - vendor/bin/phpcs --config-set installed_paths vendor/wp-coding-standards/wpcs
              - vendor/bin/phpcs --config-set ignore_errors_on_exit 1
              - vendor/bin/phpcs --config-set ignore_warnings_on_exit 1
              - vendor/bin/phpcs -p --colors --report=summary --standard=WordPress includes/*.php template/ update-notifications.php